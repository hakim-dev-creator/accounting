 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨</title>
    <style>
        :root { --primary: #1565C0; --primary-dark: #0D47A1; --bg: #f4f7f6; --white: #ffffff; --text: #333; --success: #2E7D32; --danger: #C62828; --warning: #F9A825; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: var(--bg); color: var(--text); user-select: none; -webkit-user-select: none; padding-bottom: 80px; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£Ù†ÙŠÙ‚ */
        .header { background: var(--white); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 50; }
        .logo-area { display: flex; align-items: center; gap: 12px; }
        .app-title { margin: 0; color: var(--primary); font-size: 1.3rem; font-weight: 800; }
        
        /* Ø´Ø¨ÙƒØ© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… */
        .calendar-wrapper { padding: 15px; }
        #calendarGrid { display: grid; gap: 2px; background-color: #e0e0e0; border-radius: 12px; overflow: auto; max-height: 65vh; border: 1px solid #e0e0e0; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        #calendarGrid > div { background-color: var(--white); text-align: center; padding: 10px 5px; font-size: 0.9rem; min-height: 45px; display: flex; align-items: center; justify-content: center; font-weight: 500; }
        .employee-name-cell { position: sticky; right: 0; background-color: #f8faff !important; z-index: 10; border-left: 3px solid #eee; font-weight: 700 !important; color: var(--primary-dark); }
        
        /* Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± (Ø£Ù„ÙˆØ§Ù† Ù‡Ø§Ø¯Ø¦Ø©) */
        .status-full { background-color: #E8F5E9 !important; color: var(--success); font-weight: bold; border-bottom: 2px solid var(--success); }
        .status-half { background-color: #FFF3E0 !important; color: #EF6C00; font-weight: bold; border-bottom: 2px solid #EF6C00; }
        .status-absent { background-color: #FFEBEE !important; color: var(--danger); font-weight: bold; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ© (Dock) */
        .dock { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--white); display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); z-index: 100; border-top-left-radius: 20px; border-top-right-radius: 20px; }
        .dock-btn { background: none; border: none; display: flex; flex-direction: column; align-items: center; color: #666; transition: 0.2s; }
        .dock-btn span:first-child { font-size: 1.6rem; margin-bottom: 4px; }
        .dock-btn span:last-child { font-size: 0.75rem; font-weight: 600; }
        .dock-btn:active { transform: scale(0.9); color: var(--primary); }

        /* Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø´Ù‡Ø± */
        .month-ctrl { display: flex; justify-content: space-between; align-items: center; background: var(--white); margin: 15px; padding: 10px 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .month-nav { background: #f0f4f8; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.2rem; color: var(--primary); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .modal-content { background: var(--white); padding: 25px; border-radius: 20px; width: 85%; max-width: 380px; max-height: 85vh; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.2); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        .btn-block { width: 100%; padding: 14px; border: none; border-radius: 10px; font-size: 1rem; font-weight: bold; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: #333; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-outline { background: transparent; border: 2px solid #eee; color: #555; box-shadow: none; }
        .btn-block:active { transform: scale(0.98); box-shadow: none; }

        /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        input, select { width: 100%; padding: 14px; margin: 8px 0 15px 0; border: 2px solid #eee; border-radius: 10px; box-sizing: border-box; font-size: 1rem; transition: 0.3s; background: #fafafa; }
        input:focus { border-color: var(--primary); background: #fff; outline: none; }
        label { font-weight: 700; color: #555; font-size: 0.9rem; margin-top: 5px; display: block; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ */
        .worker-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #f0f0f0; }
        .worker-info { display: flex; flex-direction: column; }
        .worker-name { font-weight: bold; color: #333; }
        .worker-rate { font-size: 0.8rem; color: #777; }
        .btn-del-sm { padding: 6px 15px; font-size: 0.8rem; border-radius: 6px; background: #ffebee; color: var(--danger); border: 1px solid #ffcdd2; }
    </style>
</head>
<body>

    <div id="contentArea" style="display:none; height: 100vh; flex-direction: column;">
        <div class="header">
            <div class="logo-area">
                <img id="displayLogo" style="height: 40px; display: none; border-radius: 8px;">
                <div><h1 id="dispNameAr" class="app-title">Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨</h1><small id="dispNameFr" style="color:#888;font-size:0.75rem"></small></div>
            </div>
            <button onclick="requestAdminAccess('settings')" style="background:none;border:none;font-size:1.6rem;color:#555">âš™ï¸</button>
        </div>

        <div class="month-ctrl">
            <button class="month-nav" onclick="changeMonth(-1)">â—€</button>
            <h3 id="monthLabel" style="margin:0;color:var(--primary-dark)"></h3>
            <button class="month-nav" onclick="changeMonth(1)">â–¶</button>
        </div>

        <div style="flex: 1; overflow: hidden;" class="calendar-wrapper">
            <div id="calendarGrid"></div>
        </div>
        
        <div style="height: 80px;"></div>

        <div class="dock">
            <button onclick="openAdvances()" class="dock-btn"><span>ğŸ’¸</span><span>ØªØ³Ø¨ÙŠÙ‚Ø§Øª</span></button>
            <button onclick="openDebts()" class="dock-btn"><span>ğŸ““</span><span>Ø§Ù„Ø¯ÙŠÙˆÙ†</span></button>
            <button onclick="printReport()" class="dock-btn"><span>ğŸ–¨</span><span>Ø·Ø¨Ø§Ø¹Ø©</span></button>
            <button onclick="openWhatsAppSelector()" class="dock-btn"><span style="color:#25D366">ğŸ“±</span><span>ÙˆØ§ØªØ³Ø§Ø¨</span></button>
        </div>
    </div>

    <div id="pinModal" class="modal" style="display:flex"><div class="modal-content" style="text-align: center;"><div style="font-size:3rem;margin-bottom:20px">â˜ï¸</div><h3 style="color:var(--primary)">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</h3></div></div>

    <div id="attModal" class="modal">
        <div class="modal-content" style="text-align:center">
            <h2 id="attEmpName" style="color:var(--primary);margin-top:0"></h2>
            <p style="color:#777;margin-bottom:20px">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</p>
            
            <button class="btn-block btn-success" onclick="saveAtt('full')">
                <span>ğŸŒ•</span> Ø­Ø¶ÙˆØ± ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ (100%)
            </button>
            
            <button class="btn-block btn-warning" onclick="saveAtt('half')">
                <span>ğŸŒ—</span> Ù†ØµÙ ÙŠÙˆÙ… (50%)
            </button>
            
            <button class="btn-block btn-danger" onclick="saveAtt('absent')">
                <span>âœ–</span> ØºÙŠØ§Ø¨
            </button>

            <button onclick="closeM('attModal')" class="btn-block btn-outline" style="margin-top:15px">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="whatsappModal" class="modal">
        <div class="modal-content">
            <h3 style="text-align:center;margin-top:0">ğŸ“± Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± ÙˆØ§ØªØ³Ø§Ø¨</h3>
            <label>Ù„Ù…Ù† ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ</label>
            <select id="waEmpSelect"></select>
            <button class="btn-block" style="background:#25D366;color:white;margin-top:15px" onclick="sendSelectedReport()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù† ğŸš€</button>
            <button onclick="closeM('whatsappModal')" class="btn-block btn-outline">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h3 style="text-align:center;margin-top:0">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            
            <div style="background:#f5f5f5;padding:15px;border-radius:12px;margin-bottom:15px">
                <h4 style="margin:0 0 10px 0;color:#555">ğŸ¢ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</h4>
                <input id="inputCompName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø© (Ø¹Ø±Ø¨ÙŠ)">
                <input id="inputCompNameFr" placeholder="Nom (Fr)">
            </div>

            <div style="background:#E3F2FD;padding:15px;border-radius:12px;margin-bottom:15px">
                <h4 style="margin:0 0 10px 0;color:var(--primary)">ğŸ”’ Ø§Ù„Ø£Ù…Ø§Ù†</h4>
                <div style="display:flex;justify-content:space-between;margin-bottom:10px"><span>Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</span><input type="checkbox" id="swPin" onchange="toggleSecurity('pin')" style="width:auto"></div>
                <div style="display:flex;justify-content:space-between"><span>Ø±Ù…Ø² Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</span><input type="checkbox" id="swAdmin" onchange="toggleSecurity('admin')" style="width:auto"></div>
            </div>

            <div>
                <h4 style="margin-bottom:10px">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</h4>
                <div style="display:flex;gap:10px">
                    <input id="newE" placeholder="Ø§Ù„Ø§Ø³Ù…" style="flex:2">
                    <input id="newR" type="number" placeholder="Ø§Ù„Ø£Ø¬Ø±" style="flex:1">
                </div>
                <button onclick="addE()" class="btn-block btn-primary">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„</button>
                
                <div id="eList" style="max-height:200px;overflow-y:auto;border:1px solid #eee;border-radius:8px;margin-top:10px"></div>
            </div>

            <button onclick="closeM('settingsModal')" class="btn-block btn-outline" style="margin-top:20px;background:#333;color:white">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="advancesModal" class="modal"><div class="modal-content"><h3 style="margin-top:0">ğŸ’¸ Ø§Ù„ØªØ³Ø¨ÙŠÙ‚Ø§Øª</h3><div id="advListArea" style="max-height:60vh;overflow-y:auto"></div><button onclick="closeM('advancesModal')" class="btn-block btn-outline" style="margin-top:10px">Ø¥ØºÙ„Ø§Ù‚</button></div></div>
    
    <div id="debtsModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0;text-align:center">ğŸ““ Ø¯ÙØªØ± Ø§Ù„Ø¯ÙŠÙˆÙ†</h3>
            <div style="display:flex;gap:10px;margin-bottom:15px">
                <button id="btnTabIn" onclick="showDebtTab('in')" class="btn-block" style="flex:1;font-size:0.9rem">Ø¯ÙŠÙˆÙ† Ù„Ù„ØªØ­ØµÙŠÙ„ (Ù„ÙŠ)</button>
                <button id="btnTabOut" onclick="showDebtTab('out')" class="btn-block" style="flex:1;font-size:0.9rem">Ø¯ÙŠÙˆÙ† Ù„Ù„ØªØ³Ø¯ÙŠØ¯ (Ø¹Ù„ÙŠ)</button>
            </div>
            
            <div id="debtSectionIn">
                <div style="display:flex;gap:5px"><input id="debtInName" list="namesList" placeholder="Ø§Ù„Ø§Ø³Ù…"><input id="debtInVal" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº"></div>
                <button onclick="addDebt('in')" class="btn-block btn-success">â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</button>
                <div style="background:#e8f5e9;padding:10px;text-align:center;font-weight:bold;margin:10px 0;border-radius:8px">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="totalIn">0</span> Ø¯Ø¬</div>
                <div id="debtInList" style="max-height:30vh;overflow-y:auto"></div>
            </div>

            <div id="debtSectionOut" style="display:none">
                <div style="display:flex;gap:5px"><input id="debtOutName" list="namesList" placeholder="Ø§Ù„Ø§Ø³Ù…"><input id="debtOutVal" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº"></div>
                <button onclick="addDebt('out')" class="btn-block btn-danger">â• Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†</button>
                <div style="background:#ffebee;padding:10px;text-align:center;font-weight:bold;margin:10px 0;border-radius:8px">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="totalOut">0</span> Ø¯Ø¬</div>
                <div id="debtOutList" style="max-height:30vh;overflow-y:auto"></div>
            </div>
            
            <datalist id="namesList"></datalist>
            
            <div style="margin-top:15px;padding-top:10px;border-top:1px dashed #ccc">
                <div style="display:flex;gap:5px;align-items:center"><select id="delType" style="flex:1;margin:0"><option value="in">ØªØ­ØµÙŠÙ„</option><option value="out">ØªØ³Ø¯ÙŠØ¯</option></select><select id="delClientSelect" onchange="updateDelRecords()" style="flex:2;margin:0"></select></div>
                <div id="delRecordContainer" style="max-height:100px;overflow-y:auto;border:1px solid #eee;margin:10px 0"></div>
                <button onclick="executeDelete()" class="btn-block btn-danger" style="font-size:0.9rem;padding:10px">Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ ğŸ—‘ï¸</button>
            </div>
            <button onclick="closeM('debtsModal')" class="btn-block btn-outline">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="historyModal" class="modal"><div class="modal-content"><h4 id="histTitle" style="margin-top:0"></h4><ul id="historyList" style="list-style:none;padding:0;max-height:50vh;overflow-y:auto"></ul><button onclick="closeM('historyModal')" class="btn-block btn-outline">Ø¥ØºÙ„Ø§Ù‚</button></div></div>

    <script type="module" src="script.js"></script>
</body>
</html>
